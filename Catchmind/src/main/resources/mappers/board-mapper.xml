<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">

	<resultMap type="post" id="postResultMap">
		<result column="POST_NO" property="postNo"/>
		<result column="POST_TITLE" property="postTitle"/>
		<result column="POST_CONTENT" property="postContent"/>
		<result column="POST_DATE" property="postDate"/>
		<result column="POST_COUNT" property="postCount"/>
		<result column="POST_STATUS" property="postStatus"/>
		<result column="POST_WRITER" property="postWriter"/>
		<result column="NICKNAME" property="nickName"/>
	</resultMap>
	<resultMap type="attach" id="attachResultMap">
		<result column="ATT_NO" property="attNo"/>
		<result column="ATT_ORIGIN" property="attOrigin"/>
		<result column="ATT_CHANGE" property="attChange"/>
		<result column="ATT_NOTICE" property="attNotice"/>
		<result column="ATT_POST" property="attPost"/>
		<result column="ATT_CATCH" property="attCatch"/>
	</resultMap>
	<resultMap type="reply" id="replyResultMap">
		<result column="REPLY_NO" property="replyNo"/>
		<result column="REPLY_CONTENT" property="replyContent"/>
		<result column="REPLY_DATE" property="replyDate"/>
		<result column="STATUS" property="status"/>
		<result column="REPLY_WRITER" property="replyWriter"/>
		<result column="REPLY_POST" property="replyPost"/>
		<result column="NICKNAME" property="replyNickName"/>
	</resultMap>
	<resultMap type="report" id="reportResultMap">
		<result column="REP_CONTENT" property="repContent"/>
		<result column="CATCH_NO" property="catchNo"/>
		<result column="POST_NO" property="postNo"/>
		<result column="REPLY_NO" property="replyNo"/>
	</resultMap>
	
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		FROM TB_POST
		WHERE POST_STATUS='Y'
	</select>
	
	<select id="selectList" resultMap="postResultMap">
		SELECT POST_NO, POST_TITLE, POST_CONTENT, TO_CHAR(POST_DATE, 'YYYY-MM-DD') "POST_DATE", POST_COUNT, POST_STATUS, NICKNAME
		FROM TB_POST
		JOIN TB_MEMBER ON (POST_WRITER=USER_NO)
		WHERE POST_STATUS = 'Y'
		ORDER BY POST_DATE DESC, POST_NO DESC
	</select>
	
	<insert id="insertPost" parameterType="post">
		INSERT INTO TB_POST(POST_NO
		, POST_TITLE, POST_CONTENT, POST_DATE
		, POST_COUNT, POST_STATUS, POST_WRITER)
		VALUES (SEQ_PNO.NEXTVAL
		, #{postTitle}, #{postContent}, SYSDATE
		, 0, 'Y', #{postWriter}
		)
	</insert>
	
	<insert id="insertFile" parameterType="attach">
		INSERT INTO TB_ATTACHMENT(ATT_NO, ATT_ORIGIN, ATT_CHANGE, ATT_POST)
		VALUES (SEQ_ANO.NEXTVAL, #{attOrigin}, #{attChange}, SEQ_PNO.CURRVAL)
	
	</insert>
	
	
	<update id="increaseCount" parameterType="_int">
		UPDATE TB_POST
		SET POST_COUNT = POST_COUNT + 1
		WHERE POST_NO = #{postNo}
		AND POST_STATUS = 'Y'
	</update>
	
	<select id="selectPost" parameterType="_int" resultMap="postResultMap">
	SELECT POST_NO, POST_TITLE, POST_CONTENT, TO_CHAR(POST_DATE, 'YYYY-MM-DD') "POST_DATE", POST_COUNT, POST_WRITER, POST_STATUS, NICKNAME
	FROM TB_POST
	JOIN TB_MEMBER ON (POST_WRITER=USER_NO)
	WHERE POST_NO = #{postNo}
	</select>
	
	<select id="selectFile" parameterType="_int" resultMap="attachResultMap">
	SELECT ATT_NO, ATT_CHANGE, ATT_POST, ATT_ORIGIN
	FROM TB_ATTACHMENT
	WHERE ATT_POST = #{attPost}
	</select>
	
	<delete id="deletePost" parameterType="_int">
		UPDATE TB_POST
		SET POST_STATUS = 'N'
		WHERE POST_NO= #{postNo}
	</delete>
	
	<insert id="insertReply" parameterType="reply">
	 INSERT INTO TB_REPLY (REPLY_NO, REPLY_CONTENT, REPLY_DATE, STATUS, REPLY_WRITER, REPLY_POST)
	 VALUES(SEQ_RNO.NEXTVAL, #{replyContent}, SYSDATE, 'Y', #{replyWriter}, #{replyPost})
	</insert>
	
	<select id="selectReplyList" parameterType="_int" resultMap="replyResultMap">
	SELECT REPLY_NO, REPLY_WRITER, REPLY_CONTENT, NICKNAME
	FROM TB_REPLY
	JOIN TB_MEMBER ON (REPLY_WRITER=USER_NO)
	WHERE TB_REPLY.STATUS='Y'
	AND REPLY_POST = #{postNo}
	ORDER BY REPLY_NO DESC
	</select>
	
	<delete id="deleteReply" parameterType="_int">
		UPDATE TB_REPLY
		SET STATUS = 'N'
		WHERE REPLY_NO= #{replyNo}
	</delete>
	
	<insert id="insertReport" parameterType="report">
		INSERT INTO TB_REPORT (REP_CONTENT, CATCH_NO, POST_NO, REPLY_NO)
		VALUES (#{repContent}, #{catchNo}, #{postNo}, #{replyNo})
	</insert>
	
	

</mapper>
